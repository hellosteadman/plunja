<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
		<title>Plunja demo</title>
		<link rel="stylesheet" href="http://netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css" />
		<script src="http://code.jquery.com/jquery-1.11.0.min.js"></script>
		<script src="http://netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>
		<script src="js/plunja.js"></script>
		<style>
			#sidebar.affix {
				width: 100%;
				top: 15px;
			}
			
			#sidebar.affix-top {
				width: 100%;
				top: 0;
			}
		</style>
	</head>
	
	<body>
		<div class="container">
			<div class="page-header">
				<h1>Plunja.js demo</h1>
			</div>
			
			<div class="row">
				<div class="col-sm-4">
					<div style="position: absolute;">
						<div data-spy="affix" data-offset-top="100" id="sidebar">
							<p>
								Plunja is a simple JavaScript templating system that takes blocks of HTML stored in <code>&lt;script&gt;</code> tags
								and renders them with context objects. It was inspired by <a href="http://jinja.pocoo.org/docs/">Jinja2</a>.
							</p>
							
							<p>
								You don&rsquo;t need a JavaScript framework to use it, as you can define your own custom locator (ie: a way of
								finding the template from the DOM). The built-in locator uses jQuery, but it&rsquo;s really simple to
								define your own.
							</p>
							
							<p><small>Made by <a href="http://steadman.io/">Steadman</a></small></p>
						</div>
					</div>
				</div>
				
				<div class="col-sm-8">
					<div class="panel panel-info" id="basic-demo">
						<div class="panel-heading">
							<h2 class="panel-title">Basic template</h2>
						</div>
						
						<div class="panel-body">
							<pre>&lt;p&gt;Hello. This is a basic template. You can click the button below to copy me as much as you like.&lt;/p&gt;</pre>

							<script type="text/html" data-template="basic">
								<p>Hello. This is a basic template. You can click the button below to copy me as much as you like.</p>
							</script>
						</div>
						
						<div class="panel-footer">
							<button class="btn btn-primary">Render the text above</button>
						</div>
					</div>
					
					<div class="panel panel-info" id="context-demo">
						<div class="panel-heading">
							<h2 class="panel-title">Context variables</h2>
						</div>
						
						<div class="panel-body">
							<pre>&lt;p&gt;The current time is &lt;strong&gt;{{ time }}&lt;/strong&gt;.&lt;/p&gt;</pre>
							
							<script type="text/html" data-template="context">
								<p>The current time is <strong>{{ time }}</strong>.
							</script>
						</div>
						
						<div class="panel-footer">
							<button class="btn btn-primary">Render the text above</button>
						</div>
					</div>
					
					<div class="panel panel-info" id="filters-demo">
						<div class="panel-heading">
							<h2 class="panel-title">Filters</h2>
						</div>
						
						<div class="panel-body">
							<pre>&lt;p&gt;The current weekday is &lt;strong&gt;{{ weekday|uppercase }}&lt;/strong&gt;.&lt;/p&gt;</pre>

							<script type="text/html" data-template="filters">
								<p>The current weekday is <strong>{{ weekday|uppercase }}</strong>.
							</script>
						</div>
						
						<div class="panel-footer">
							<button class="btn btn-primary">Render the text above</button>
						</div>
					</div>
					
					<div class="panel panel-default" id="usage">
						<div class="panel-heading">
							<h2 class="panel-title">Usage</h2>
						</div>
						
						<div class="panel-body">
							<p>You can use it with jQuery out-of-the-box, by including jQuery and the plunja.js file.</p>
							
							<h3>Initialising Plunja.js</h3>
							<p>Start by creating a template registry which you&rsquo;ll then use to locate and render your templates.</p>
							
							<pre>
&lt;script&gt;
  $(document).ready(
    function() {
      var templates = new TemplateRegistry();
    }
  );
&lt;/script&gt;
</pre>
							
							<p>If you want to use Plunja.js without jQuery, or you have a better method for locating templates, you&rsquo;ll need to define your own locator, like so:</p>
							
							<pre>
&lt;script&gt;
  var templates = new TemplateRegistry(
    {
      locator: function(name, callback) {
          callback(document.getElementById('template-' + name).innerHTML);
      }
    }
  );
&lt;/script&gt;
</pre>
							
							<p>You can define your own filters, to go with the couple of sample ones already bundled in:</p>
							
							<pre>
&lt;script&gt;
  var templates = new TemplateRegistry(
    {
      filters: {
        reversed: function(value) {
          var ret = '';
          
          for(var i = 0; i &lt; value.length; i ++) {
            ret = value[i] + ret;
          }
          
          return ret;
        }
      }
    }
  );
&lt;/script&gt;
</pre>

							<h3>Defining templates</h3>
							<p>By default, templates are stored in <code>&lt;script&gt;</code> tags, with a <code>data-template</code> attribute used to identify the template by name.</p>
							
							<pre>
&lt;script type="text/html" data-template="mytemplate"&gt;
  This is some text. This is a {{ var }}.
&lt;/script&gt;
</pre>
							
							<h3>Rendering the template</h3>
							<p>Templates are rendered asynchronously. You can pass variables into the template, which can be accessed using the <code>{{ varname }}</code> notation depicted above.</p>
							<pre>
&lt;script&gt;
  $(document).ready(
    function() {
      templates.get('mytemplate').on('render',
        function(html) {
          // Populate the div on the page with content from the rendered template
          $('div').html(html);
        }
      ).render(
        {
          var: 'variable'
        }
      );
    }
  );
&lt;/script&gt;
</pre>
							<p>A shortcut to the same end, without jQuery:</p>
							<pre>
&lt;script&gt;
  // Render the template to a div with an ID of 'mainDiv'
  templates.get('mytemplate').renderTo(
    document.getElementById('mainDiv'),
    {
      var: 'variable'
    }
  );
&lt;/script&gt;
</pre>
							<p>Replace <code>renderTo</code> with <code>appendTo</code> to append content to the element, rather than replacing the HTML of the element.</p>
							
							<h3>Asynchronicity <small>(not a real word)</small></h3>
							<p>
								Because everything is asynchronous, you can define a template locator that uses AJAX. Your locator
								function needs to accept two arguments: a string containing the template name, and a callback
								argument.
							</p>
							
							<p>
								When obtaining a template from an AJAX request, you simply call the supplied callback function,
								passing in the contents of the template, or <code>false</code> if the template couldn&rsquo;t be
								found.
							</p>
							
							<h3>The registry and events</h3>
							<p>
								Templates are stored as objects and placed inside a registry, so each time you access the same
								template, you&rsquo;re accessing a single object instance per template.
							</p>
							
							<p>
								Call <code>templates.get()</code> with the name of the template, and you&rsquo;ll get a <code>Template</code>
								object back. Call <code>template.on('render', function(html) {... })</code> to attach to the
								<code>render</code> method if you want to perform any dynamic actions once rendering has taken place.
							</p>
						</div>
					</div>
				</div>
			</div>
		</div>
		
		<script>
			$(document).ready(
				function() {
					var templates = new TemplateRegistry();
					
					$('#basic-demo .btn').on('click',
						function() {
							var panel = $(this).closest('.panel');
							var template = 'basic';
							
							templates.get(template).on('render',
								function(html) {
									panel.removeClass('panel-info').addClass('panel-success');
								}
							).appendTo(
								panel.find('.panel-body').get(0)
							);
						}
					);
					
					$('#context-demo .btn').on('click',
						function() {
							var panel = $(this).closest('.panel');
							var template = 'context';
							var now = new Date();
							
							templates.get(template).on('render',
								function(html) {
									panel.removeClass('panel-info').addClass('panel-success');
								}
							).appendTo(
								panel.find('.panel-body').get(0),
								{
									time: now.toString()
								}
							);
						}
					);
					
					$('#filters-demo .btn').on('click',
						function() {
							var panel = $(this).closest('.panel');
							var template = 'filters';
							var now = new Date();
							
							templates.get(template).on('render',
								function(html) {
									panel.removeClass('panel-info').addClass('panel-success');
								}
							).appendTo(
								panel.find('.panel-body').get(0),
								{
									weekday: now.toString().split(' ')[0]
								}
							);
						}
					);
				}
			);
		</script>
	</body>
</html>